# 代码验收通过标准

## 一、代码质量标准

### 1.1 代码规范

| 标准 | 描述 | 检查方式 |
|------|------|----------|
| ESLint | 无 ESLint 错误和警告 | `pnpm lint` |
| Prettier | 代码格式统一 | `pnpm format:check` |
| TypeScript | 无类型错误 | `pnpm type-check` |
| 命名规范 | 变量、函数、类命名符合约定 | 代码审查 |
| 注释规范 | 关键逻辑有注释说明 | 代码审查 |

### 1.2 代码复杂度

| 指标 | 标准 | 检查工具 |
|------|------|----------|
| 函数长度 | 不超过 50 行 | ESLint |
| 文件长度 | 不超过 500 行 | ESLint |
| 圈复杂度 | 不超过 10 | ESLint complex-city |
| 嵌套深度 | 不超过 4 层 | 代码审查 |
| 参数数量 | 不超过 5 个 | ESLint |

### 1.3 代码重复率

| 指标 | 标准 |
|------|------|
| 重复代码 | < 5% |
| 相似代码块 | < 10% |

---

## 二、测试覆盖标准

### 2.1 单元测试覆盖率

| 模块 | 行覆盖率 | 分支覆盖率 | 函数覆盖率 |
|------|----------|------------|------------|
| 服务层 (Service) | ≥ 90% | ≥ 85% | ≥ 90% |
| 控制器层 (Controller) | ≥ 85% | ≥ 80% | ≥ 85% |
| 工具函数 (Utils) | ≥ 95% | ≥ 90% | ≥ 95% |
| 前端组件 (Components) | ≥ 80% | ≥ 75% | ≥ 80% |
| 前端 Composables | ≥ 85% | ≥ 80% | ≥ 85% |

### 2.2 E2E 测试覆盖

| 功能模块 | 测试用例数 | 优先级 | 必须通过 |
|----------|------------|--------|----------|
| 首页 | ≥ 5 | P0 | ✅ |
| 文章详情 | ≥ 6 | P0 | ✅ |
| 用户认证 | ≥ 6 | P0 | ✅ |
| 文章管理 | ≥ 7 | P0 | ✅ |
| 分类管理 | ≥ 5 | P0 | ✅ |
| 标签管理 | ≥ 5 | P0 | ✅ |
| 系统设置 | ≥ 4 | P1 | ✅ |
| 用户管理 | ≥ 4 | P1 | ✅ |

### 2.3 测试通过标准

```bash
# 所有单元测试必须通过
pnpm test -- --passWithNoTests=false

# 所有 E2E 测试必须通过
pnpm test:e2e

# 覆盖率检查
pnpm test:coverage
# 覆盖率报告必须显示达到上述标准
```

---

## 三、功能验收标准

### 3.1 前台功能

#### 首页
- [ ] 文章列表正确显示（标题、摘要、日期、作者）
- [ ] 分页功能正常工作
- [ ] 精选文章正确展示
- [ ] 响应式布局正常
- [ ] 加载时间 < 2 秒

#### 文章详情页
- [ ] Markdown 内容正确渲染
- [ ] 代码高亮正常
- [ ] 目录导航生成正确
- [ ] 点赞功能正常
- [ ] 阅读计数正确累加
- [ ] 上一篇/下一篇导航正常

#### 分类/标签页
- [ ] 分类/标签列表正确显示
- [ ] 筛选功能正常
- [ ] 文章计数正确

#### 关于页面
- [ ] 个人信息正确显示
- [ ] 社交媒体链接正常

### 3.2 后台功能

#### 用户认证
- [ ] 登录功能正常
- [ ] 登出功能正常
- [ ] Token 刷新正常
- [ ] 受保护路由正确拦截
- [ ] 密码加密存储

#### 文章管理
- [ ] 创建文章成功
- [ ] 编辑文章成功
- [ ] 删除文章成功
- [ ] 发布/下架功能正常
- [ ] 置顶功能正常
- [ ] 草稿功能正常
- [ ] 文章列表分页正常
- [ ] 文章搜索正常

#### 分类管理
- [ ] 创建分类成功
- [ ] 编辑分类成功
- [ ] 删除分类成功
- [ ] 分类列表显示正常

#### 标签管理
- [ ] 创建标签成功
- [ ] 编辑标签成功
- [ ] 删除标签成功
- [ ] 标签列表显示正常

#### 系统设置
- [ ] 站点配置保存成功
- [ ] SEO 设置生效
- [ ] 数据备份功能正常

---

## 四、性能验收标准

### 4.1 前端性能

| 指标 | 标准 | 检查工具 |
|------|------|----------|
| 首屏加载 (FCP) | < 1.5 秒 | Lighthouse |
| 最大内容绘制 (LCP) | < 2.5 秒 | Lighthouse |
| 首次输入延迟 (FID) | < 100ms | Lighthouse |
| 累积布局偏移 (CLS) | < 0.1 | Lighthouse |
| 页面完全加载 | < 3 秒 | 浏览器 DevTools |
| JavaScript 包大小 | < 500KB (gzip) | Webpack Bundle Analyzer |

### 4.2 后端性能

| 指标 | 标准 | 检查方式 |
|------|------|----------|
| API 响应时间 (P95) | < 200ms | 日志/监控 |
| API 响应时间 (P99) | < 500ms | 日志/监控 |
| 数据库查询时间 | < 50ms | Prisma 日志 |
| 并发处理能力 | ≥ 100 QPS | 压力测试 |
| 内存使用 | < 512MB | 系统监控 |

### 4.3 性能测试命令

```bash
# 前端性能测试
pnpm lighthouse http://localhost:5173

# 后端压力测试
pnpm test:load

# 数据库查询分析
pnpm prisma studio
```

---

## 五、安全验收标准

### 5.1 代码安全

| 检查项 | 标准 | 检查工具 |
|--------|------|----------|
| XSS 防护 | 所有用户输入已转义 | 代码审查 |
| CSRF 防护 | Token 验证启用 | 代码审查 |
| SQL 注入 | 使用参数化查询 | 代码审查 |
| 密码安全 | bcrypt 加密，cost ≥ 10 | 代码审查 |
| JWT 安全 | 密钥强度 ≥ 32 字符 | 代码审查 |
| 依赖安全 | 无高危漏洞 | `pnpm audit` |

### 5.2 接口安全

| 检查项 | 标准 |
|--------|------|
| 认证检查 | 所有受保护接口有认证 |
| 授权检查 | 权限验证正确实施 |
| 输入验证 | 所有输入有验证 |
| 速率限制 | API 有速率限制 |
| 错误处理 | 不泄露敏感信息 |

### 5.3 安全检查命令

```bash
# 依赖安全审计
pnpm audit

# 前端安全检查
pnpm audit:frontend

# 后端安全检查
pnpm audit:backend
```

---

## 六、文档验收标准

### 6.1 代码文档

| 文档类型 | 要求 | 状态 |
|----------|------|------|
| README | 项目介绍、快速开始 | ☐ |
| API 文档 | 所有接口有文档 | ☐ |
| 组件文档 | 组件有 Props/Events 说明 | ☐ |
| 类型定义 | 类型有注释说明 | ☐ |

### 6.2 提交规范

| 要求 | 描述 |
|------|------|
| Commit Message | 符合 Conventional Commits |
| PR 描述 | 清晰描述变更内容 |
| 变更日志 | 重大变更有 CHANGELOG 更新 |

---

## 七、部署验收标准

### 7.1 构建检查

```bash
# 前端构建无错误
cd frontend && pnpm build
# 输出无错误，生成 dist 目录

# 后端构建无错误
cd backend && pnpm build
# 输出无错误，生成 dist 目录
```

### 7.2 环境变量

| 变量 | 要求 |
|------|------|
| NODE_ENV | production |
| JWT_SECRET | 已设置且安全 |
| DATABASE_URL | 已设置 |
| API_URL | 已设置 |

### 7.3 健康检查

| 检查项 | 端点 | 预期响应 |
|--------|------|----------|
| API 健康 | `/health` | 200 OK |
| 数据库连接 | `/health/db` | 200 OK |
| 前端服务 | `/` | 200 OK |

---

## 八、验收流程

### 8.1 开发阶段验收

```
开发完成
    ↓
运行 lint 和 format 检查
    ↓
运行单元测试（覆盖率检查）
    ↓
运行 E2E 测试
    ↓
代码审查
    ↓
合并到开发分支
```

### 8.2 发布前验收

```
开发分支完成
    ↓
运行完整测试套件
    ↓
性能测试
    ↓
安全扫描
    ↓
文档检查
    ↓
预发布环境验证
    ↓
生产环境部署
```

### 8.3 验收检查清单

```markdown
## 代码验收检查清单

### 代码质量
- [ ] ESLint 检查通过
- [ ] Prettier 格式检查通过
- [ ] TypeScript 类型检查通过
- [ ] 无代码异味

### 测试覆盖
- [ ] 单元测试覆盖率达标
- [ ] E2E 测试全部通过
- [ ] 关键功能有测试覆盖

### 功能验收
- [ ] 所有功能按需求实现
- [ ] 边界情况已处理
- [ ] 错误处理完善

### 性能验收
- [ ] 前端性能指标达标
- [ ] 后端响应时间达标
- [ ] 无明显性能问题

### 安全验收
- [ ] 安全审计通过
- [ ] 无已知漏洞
- [ ] 敏感数据已加密

### 文档验收
- [ ] README 完整
- [ ] API 文档完整
- [ ] 代码注释清晰

### 部署验收
- [ ] 构建成功
- [ ] 环境变量配置正确
- [ ] 健康检查通过
```

---

## 九、CI/CD 集成

### 9.1 GitHub Actions 配置示例

```yaml
name: Code Acceptance

on: [push, pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      - run: pnpm install
      - run: pnpm lint
      - run: pnpm format:check
      - run: pnpm type-check

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      - run: pnpm install
      - run: pnpm test
      - run: pnpm test:e2e
      - run: pnpm test:coverage

  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '20'
      - run: pnpm install
      - run: pnpm audit
```

---

## 十、问题处理流程

### 10.1 验收失败处理

1. **记录问题** - 详细记录失败原因
2. **优先级分类** - P0/P1/P2
3. **分配修复** - 分配给对应开发者
4. **修复验证** - 修复后重新验收
5. **文档更新** - 更新验收记录

### 10.2 例外情况处理

| 情况 | 处理方式 |
|------|----------|
| 紧急修复 | 可先部署后补测试 |
| 技术债务 | 记录到 TODO，限期修复 |
| 性能优化 | 单独排期优化 |
